<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§¹ ãŠæƒé™¤è¨˜éŒ²</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <style>
        :root {
            --primary: #00c853;
            --primary-dark: #00a844;
            --secondary: #64b5f6;
            --accent: #ffb74d;
            --success: #69f0ae;
            --bg: #e8f5e9;
            --card: #ffffff;
            --text: #2e7d32;
            --text-muted: #66bb6a;
            --text-dark: #1b5e20;
            --shadow: rgba(0, 100, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Hiragino Sans', sans-serif;
            background: linear-gradient(135deg, var(--bg) 0%, #c8e6c9 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        header h1 {
            font-size: 2rem;
            margin-bottom: 5px;
            color: var(--text-dark);
        }
        
        header p {
            color: var(--text-muted);
            font-style: italic;
        }
        
        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px var(--shadow);
            border: 1px solid rgba(0, 200, 83, 0.2);
        }
        
        .card h2 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-dark);
        }
        
        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .input-group.full {
            grid-template-columns: 1fr;
        }
        
        label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #c8e6c9;
            border-radius: 10px;
            background: #f1f8e9;
            color: var(--text-dark);
            font-size: 1rem;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: #ffffff;
        }
        
        select option {
            background: var(--card);
            color: var(--text-dark);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .char-counter {
            text-align: right;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 5px;
        }
        
        .char-counter.warning {
            color: var(--accent);
        }
        
        .char-counter.over {
            color: #e74c3c;
        }
        
        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,200,83,0.4);
        }
        
        .btn-secondary {
            background: #e8f5e9;
            color: var(--text-dark);
            margin-top: 10px;
            border: 1px solid #c8e6c9;
        }
        
        .btn-secondary:hover {
            background: #c8e6c9;
        }
        
        /* æ˜Ÿè©•ä¾¡ */
        .star-rating {
            display: flex;
            gap: 5px;
            flex-direction: row-reverse;
            justify-content: flex-end;
        }
        
        .star-rating input {
            display: none;
        }
        
        .star-rating label {
            font-size: 1.8rem;
            cursor: pointer;
            color: #c8e6c9;
            transition: all 0.2s;
            margin-bottom: 0;
        }
        
        .star-rating label:hover,
        .star-rating label:hover ~ label,
        .star-rating input:checked ~ label {
            color: var(--accent);
        }
        
        /* æƒé™¤å ´æ‰€ã‚¿ã‚° */
        .place-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .place-tag {
            padding: 8px 15px;
            border-radius: 20px;
            background: #e8f5e9;
            border: 1px solid #a5d6a7;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            color: var(--text-dark);
        }
        
        .place-tag:hover {
            background: #c8e6c9;
        }
        
        .place-tag.selected {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--primary);
        }
        
        /* ç›®æ¨™è¨­å®š */
        .goal-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .goal-section input {
            width: 80px;
        }
        
        .goal-section span {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .goal-progress {
            flex: 1;
            height: 20px;
            background: #e8f5e9;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #c8e6c9;
        }
        
        .goal-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--accent));
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .goal-text {
            font-size: 0.85rem;
            color: var(--text-muted);
            min-width: 60px;
            text-align: right;
        }
        
        /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .stat-item {
            background: #f1f8e9;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #c8e6c9;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-dark);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 5px;
        }
        
        .stat-item.highlight {
            background: linear-gradient(135deg, #e8f5e9, #fff8e1);
            border: 2px solid var(--accent);
        }
        
        .stat-item.highlight .stat-value {
            color: #e65100;
        }
        
        /* ã‚¹ãƒˆãƒªãƒ¼ã‚¯ */
        .streak-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: linear-gradient(135deg, var(--accent), #ff8a65);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
            color: white;
        }
        
        /* ã‚°ãƒ©ãƒ• */
        .chart-container {
            position: relative;
            height: 250px;
        }
        
        /* å±¥æ­´ */
        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 15px;
            background: #f1f8e9;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid #c8e6c9;
        }
        
        .history-item:hover {
            background: #e8f5e9;
            border-color: var(--primary);
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .history-date {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .history-place {
            font-size: 0.9rem;
            color: var(--secondary);
            margin-top: 3px;
        }
        
        .history-time {
            font-size: 0.85rem;
            color: var(--primary-dark);
            margin-top: 3px;
        }
        
        .history-stars {
            font-size: 1rem;
            color: var(--accent);
        }
        
        .history-note {
            margin-top: 10px;
            padding: 10px;
            background: #ffffff;
            border-radius: 8px;
            border-left: 3px solid var(--secondary);
        }
        
        .history-note-label {
            font-size: 0.75rem;
            color: var(--secondary);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .history-note-text {
            font-size: 0.9rem;
            color: var(--text-dark);
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .delete-btn {
            background: none;
            border: none;
            color: #bdbdbd;
            cursor: pointer;
            padding: 5px;
            font-size: 1.2rem;
            width: auto;
        }
        
        .delete-btn:hover {
            color: #e53935;
        }
        
        .edit-btn {
            background: none;
            border: none;
            color: #bdbdbd;
            cursor: pointer;
            padding: 5px;
            font-size: 1rem;
            width: auto;
        }
        
        .edit-btn:hover {
            color: var(--secondary);
        }
        
        .action-buttons {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* æƒé™¤ã®ã‚³ãƒ„ */
        .tips-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .tip-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 15px;
            background: #f1f8e9;
            border-radius: 10px;
            transition: all 0.3s;
            border: 1px solid #c8e6c9;
        }
        
        .tip-item:hover {
            background: #e8f5e9;
            border-color: var(--primary);
        }
        
        .tip-icon {
            font-size: 1.5rem;
            min-width: 40px;
            text-align: center;
        }
        
        .tip-content {
            flex: 1;
        }
        
        .tip-title {
            font-weight: bold;
            font-size: 0.95rem;
            color: var(--primary-dark);
            margin-bottom: 3px;
        }
        
        .tip-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
            line-height: 1.4;
        }
        
        .tip-actions {
            display: flex;
            gap: 5px;
        }
        
        .tip-add-form {
            background: #f1f8e9;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px dashed #a5d6a7;
        }
        
        .tip-add-form .input-group {
            margin-bottom: 10px;
        }
        
        /* å‚è€ƒãƒªãƒ³ã‚¯ */
        .link-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .link-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: #f1f8e9;
            border-radius: 10px;
            text-decoration: none;
            color: var(--text-dark);
            transition: all 0.3s;
            border: 1px solid #c8e6c9;
        }
        
        .link-item:hover {
            background: #e8f5e9;
            transform: translateX(5px);
            border-color: var(--primary);
        }
        
        .link-icon {
            font-size: 1.5rem;
            min-width: 40px;
            text-align: center;
        }
        
        .link-info {
            flex: 1;
        }
        
        .link-title {
            font-weight: bold;
            font-size: 0.95rem;
            color: var(--primary-dark);
            margin-bottom: 3px;
        }
        
        .link-desc {
            font-size: 0.8rem;
            color: var(--text-muted);
            line-height: 1.4;
        }
        
        .link-arrow {
            font-size: 1.2rem;
            color: var(--text-muted);
        }
        
        /* åŠ©è¨€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .advice-section {
            background: linear-gradient(135deg, #e8f5e9, #e3f2fd);
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            border: 1px solid #a5d6a7;
        }
        
        .advice-title {
            font-size: 1rem;
            color: var(--primary-dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .advice-text {
            font-size: 0.9rem;
            color: var(--text-dark);
            line-height: 1.8;
        }
        
        .advice-text p {
            margin-bottom: 10px;
        }
        
        .advice-text p:last-child {
            margin-bottom: 0;
        }
        
        /* ä»Šé€±ã®ã‚µãƒãƒªãƒ¼ */
        .week-summary {
            display: flex;
            justify-content: space-between;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .day-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e8f5e9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: var(--text-muted);
            border: 2px solid #c8e6c9;
        }
        
        .day-circle.done {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--primary);
        }
        
        .day-circle.today {
            border: 3px solid var(--accent);
        }
        
        /* ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .edit-modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .edit-modal-content {
            background: #ffffff;
            padding: 25px;
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: popIn 0.3s ease;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .edit-modal-content h3 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-dark);
        }
        
        .edit-modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .edit-modal-buttons button {
            flex: 1;
        }
        
        .btn-cancel {
            background: #e8f5e9;
            color: var(--text-dark);
            border: 1px solid #c8e6c9;
        }
        
        .btn-cancel:hover {
            background: #c8e6c9;
        }
        
        /* ãŠç¥ã„ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: #ffffff;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 90%;
            animation: popIn 0.5s ease;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .modal-content h2 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            justify-content: center;
            color: var(--text-dark);
        }
        
        .modal-content .days {
            font-size: 4rem;
            font-weight: bold;
            color: var(--primary);
            margin: 20px 0;
        }
        
        .confetti {
            font-size: 3rem;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }
        
        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 500px) {
            .input-group {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stat-value {
                font-size: 1.3rem;
            }
            
            .day-circle {
                width: 35px;
                height: 35px;
                font-size: 0.7rem;
            }
        }
        
        /* ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒœã‚¿ãƒ³ */
        .data-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .data-buttons-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .sync-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            text-align: center;
            display: none;
        }
        
        .sync-status.success {
            display: block;
            background: #e8f5e9;
            color: var(--primary-dark);
            border: 1px solid #a5d6a7;
        }
        
        .sync-status.error {
            display: block;
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }
        
        .sync-status.loading {
            display: block;
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #90caf9;
        }
        
        @media (max-width: 500px) {
            .data-buttons-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§¹ ãŠæƒé™¤è¨˜éŒ²</h1>
            <p>ã€œ æƒé™¤ã¯è‡ªåˆ†ã®å¿ƒã‚’ç£¨ãã“ã¨ ã€œ</p>
        </header>
        
        <!-- ä»Šé€±ã®ã‚µãƒãƒªãƒ¼ -->
        <div class="card">
            <h2>ğŸ“… ä»Šé€±ã®æƒé™¤çŠ¶æ³</h2>
            <div class="week-summary" id="weekSummary"></div>
            <p id="weekMessage" style="font-size: 0.9rem; color: var(--text-muted); text-align: center;"></p>
        </div>
        
        <!-- è¨˜éŒ²å…¥åŠ› -->
        <div class="card">
            <h2>ğŸ“ æƒé™¤ã‚’è¨˜éŒ²</h2>
            <div class="input-group full">
                <div>
                    <label>æ—¥ä»˜</label>
                    <input type="date" id="cleanDate">
                </div>
            </div>
            <div class="input-group full">
                <div>
                    <label>æƒé™¤ã—ãŸå ´æ‰€ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
                    <div class="place-tags" id="placeTags">
                        <span class="place-tag" data-place="ãƒªãƒ“ãƒ³ã‚°">ğŸ›‹ï¸ ãƒªãƒ“ãƒ³ã‚°</span>
                        <span class="place-tag" data-place="ã‚­ãƒƒãƒãƒ³">ğŸ³ ã‚­ãƒƒãƒãƒ³</span>
                        <span class="place-tag" data-place="æµ´å®¤">ğŸ› æµ´å®¤</span>
                        <span class="place-tag" data-place="ãƒˆã‚¤ãƒ¬">ğŸš½ ãƒˆã‚¤ãƒ¬</span>
                        <span class="place-tag" data-place="å¯å®¤">ğŸ›ï¸ å¯å®¤</span>
                        <span class="place-tag" data-place="ç„é–¢">ğŸšª ç„é–¢</span>
                        <span class="place-tag" data-place="ãƒ™ãƒ©ãƒ³ãƒ€">ğŸŒ¿ ãƒ™ãƒ©ãƒ³ãƒ€</span>
                        <span class="place-tag" data-place="ä»•äº‹å ´">ğŸ’¼ ä»•äº‹å ´</span>
                        <span class="place-tag" data-place="æ›¸é¡">ğŸ“„ æ›¸é¡</span>
                        <span class="place-tag" data-place="ãã®ä»–">âœ¨ ãã®ä»–</span>
                    </div>
                </div>
            </div>
            <div class="input-group full">
                <div>
                    <label>æº€è¶³åº¦</label>
                    <div class="star-rating">
                        <input type="radio" id="star5" name="rating" value="5">
                        <input type="radio" id="star4" name="rating" value="4">
                        <input type="radio" id="star3" name="rating" value="3" checked>
                        <input type="radio" id="star2" name="rating" value="2">
                        <input type="radio" id="star1" name="rating" value="1">
                        <label for="star5">â­</label>
                        <label for="star4">â­</label>
                        <label for="star3">â­</label>
                        <label for="star2">â­</label>
                        <label for="star1">â­</label>
                    </div>
                </div>
            </div>
            <div class="input-group full">
                <div>
                    <label>â±ï¸ æƒé™¤æ™‚é–“</label>
                    <select id="cleanTime">
                        <option value="15">15åˆ†</option>
                        <option value="30" selected>30åˆ†</option>
                        <option value="45">45åˆ†</option>
                        <option value="60">1æ™‚é–“</option>
                        <option value="75">1æ™‚é–“15åˆ†</option>
                        <option value="90">1æ™‚é–“30åˆ†</option>
                        <option value="105">1æ™‚é–“45åˆ†</option>
                        <option value="120">2æ™‚é–“</option>
                        <option value="135">2æ™‚é–“15åˆ†</option>
                        <option value="150">2æ™‚é–“30åˆ†</option>
                        <option value="165">2æ™‚é–“45åˆ†</option>
                        <option value="180">3æ™‚é–“</option>
                    </select>
                </div>
            </div>
            <div class="input-group full">
                <div>
                    <label>ğŸ’­ ä»Šæ—¥ã®æ°—ã¥ããƒ»ãƒ¡ãƒ¢</label>
                    <textarea id="cleanNote" placeholder="ä¾‹ï¼šçª“ã‚’é–‹ã‘ã¦æ›æ°—ã—ãªãŒã‚‰æƒé™¤ã™ã‚‹ã¨æ°—æŒã¡ãŒã„ã„ã€‚æ’æ°´å£ã‚‚ãƒ”ã‚«ãƒ”ã‚«ã«ã—ãŸã€‚" maxlength="500" oninput="updateCharCounter()"></textarea>
                    <div class="char-counter" id="charCounter">0 / 500</div>
                </div>
            </div>
            <button class="btn-primary" onclick="addRecord()">âœ¨ è¨˜éŒ²ã™ã‚‹</button>
        </div>
        
        <!-- å±¥æ­´ -->
        <div class="card">
            <h2>ğŸ“‹ è¨˜éŒ²å±¥æ­´</h2>
            <div class="history-list" id="historyList">
                <div class="empty-state">
                    <div class="icon">ğŸ§¹</div>
                    <p>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“<br>æœ€åˆã®æƒé™¤ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼</p>
                </div>
            </div>
            
            <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒœã‚¿ãƒ³ç¾¤ -->
            <div class="data-buttons">
                <div class="data-buttons-row">
                    <button class="btn-secondary" onclick="exportData()">ğŸ“¤ JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
                    <button class="btn-secondary" onclick="document.getElementById('importFile').click()">ğŸ“¥ JSONã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                </div>
            </div>
            <div id="syncStatus" class="sync-status"></div>
        </div>
        
        <!-- ç›®æ¨™è¨­å®š -->
        <div class="card">
            <h2>ğŸ¯ é€±é–“ç›®æ¨™</h2>
            <div class="goal-section">
                <span>é€±ã«</span>
                <input type="number" id="goalDays" min="1" max="7" onchange="changeGoal()">
                <span>æ—¥ä»¥ä¸Š</span>
                <div class="goal-progress">
                    <div class="goal-progress-bar" id="goalBar"></div>
                </div>
                <span class="goal-text" id="goalText">---%</span>
            </div>
            <p id="goalMessage" style="font-size: 0.9rem; color: var(--text-muted);"></p>
        </div>
        
        <!-- çµ±è¨ˆ -->
        <div class="card">
            <h2>ğŸ“Š çµ±è¨ˆ</h2>
            <div class="stats-grid">
                <div class="stat-item highlight">
                    <div class="stat-value" id="currentStreak">0</div>
                    <div class="stat-label">ğŸ”¥ é€£ç¶šæ—¥æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="bestStreak">0</div>
                    <div class="stat-label">ğŸ† æœ€é«˜é€£ç¶š</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="monthlyCount">0</div>
                    <div class="stat-label">ä»Šæœˆã®å›æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="monthlyTime">0</div>
                    <div class="stat-label">â±ï¸ ä»Šæœˆã®æ™‚é–“</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalCount">0</div>
                    <div class="stat-label">ç·è¨˜éŒ²æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalTime">0</div>
                    <div class="stat-label">â±ï¸ ç·æ™‚é–“</div>
                </div>
            </div>
            <div id="streakContainer" style="text-align: center;"></div>
        </div>
        
        <!-- ã‚°ãƒ©ãƒ• -->
        <div class="card">
            <h2>ğŸ“ˆ æƒé™¤å›æ•°ã®æ¨ç§»ï¼ˆé€±åˆ¥ï¼‰</h2>
            <div class="chart-container">
                <canvas id="cleanChart"></canvas>
            </div>
        </div>
        
        <!-- æƒé™¤ã®ã‚³ãƒ„ -->
        <div class="card">
            <h2>ğŸ’¡ æƒé™¤ã®ã‚³ãƒ„</h2>
            <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px;">è‡ªåˆ†ã ã‘ã®æƒé™¤ã®ã‚³ãƒ„ã‚’ç™»éŒ²ã—ã‚ˆã†ï¼ï¼ˆæœ€å¤§5ä»¶ï¼‰</p>
            
            <!-- ã‚³ãƒ„è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
            <div class="tip-add-form" id="tipAddForm">
                <div class="input-group full">
                    <div>
                        <label>ã‚¢ã‚¤ã‚³ãƒ³</label>
                        <select id="tipIcon">
                            <option value="â°">â° æ™‚è¨ˆ</option>
                            <option value="ğŸµ">ğŸµ éŸ³æ¥½</option>
                            <option value="ğŸ“¦">ğŸ“¦ ç®±</option>
                            <option value="âœ¨">âœ¨ ã‚­ãƒ©ã‚­ãƒ©</option>
                            <option value="ğŸ§¹">ğŸ§¹ ã»ã†ã</option>
                            <option value="ğŸŒŸ">ğŸŒŸ æ˜Ÿ</option>
                            <option value="ğŸ’ª">ğŸ’ª ç­‹è‚‰</option>
                            <option value="ğŸ¯">ğŸ¯ çš„</option>
                            <option value="â˜€ï¸">â˜€ï¸ å¤ªé™½</option>
                            <option value="ğŸŒ¸">ğŸŒ¸ èŠ±</option>
                        </select>
                    </div>
                </div>
                <div class="input-group full">
                    <div>
                        <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
                        <input type="text" id="tipTitle" placeholder="ä¾‹ï¼šæœã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã«çµ„ã¿è¾¼ã‚€" maxlength="30">
                    </div>
                </div>
                <div class="input-group full">
                    <div>
                        <label>èª¬æ˜</label>
                        <input type="text" id="tipDesc" placeholder="ä¾‹ï¼šèµ·åºŠå¾Œã®5åˆ†æƒé™¤ã§1æ—¥ã‚’æ°—æŒã¡ã‚ˆãã‚¹ã‚¿ãƒ¼ãƒˆ" maxlength="50">
                    </div>
                </div>
                <button class="btn-primary" onclick="addTip()">ï¼‹ ã‚³ãƒ„ã‚’è¿½åŠ </button>
            </div>
            
            <!-- ã‚³ãƒ„ãƒªã‚¹ãƒˆ -->
            <div class="tips-list" id="tipsList"></div>
        </div>
        
        <!-- å‚è€ƒã«ãªã‚‹ãƒªãƒ³ã‚¯é›† -->
        <div class="card">
            <h2>ğŸ¬ å‚è€ƒã«ãªã‚‹YouTubeãƒ»ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ</h2>
            <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px;">æƒé™¤ãŒæ¥½ã—ããªã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’é›†ã‚ã¾ã—ãŸ</p>
            
            <div class="link-list">
                <a href="https://www.youtube.com/@motegi-souji" target="_blank" rel="noopener noreferrer" class="link-item">
                    <span class="link-icon">ğŸ¥</span>
                    <div class="link-info">
                        <div class="link-title">èŒ‚æœ¨æµæƒé™¤è¬›åº§ã€èŒ‚æœ¨å’Œå“‰ã€‘</div>
                        <div class="link-desc">æ´—å‰¤ã®ãƒ—ãƒ­ãŒæ•™ãˆã‚‹ã€ã‚³ã‚¹ãƒ‘æŠœç¾¤ã®ãŠæƒé™¤ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</div>
                    </div>
                    <span class="link-arrow">â†’</span>
                </a>
                <a href="https://www.youtube.com/@osouji-pro-kiyokiyo" target="_blank" rel="noopener noreferrer" class="link-item">
                    <span class="link-icon">ğŸ¥</span>
                    <div class="link-info">
                        <div class="link-title">ãŠæƒé™¤è·äººãã‚ˆãã‚ˆ</div>
                        <div class="link-desc">35å¹´ä»¥ä¸Šã®ãƒ—ãƒ­ãŒæ•™ãˆã‚‹ã€å®¶åº­ã§ä½¿ãˆã‚‹æƒé™¤è¡“</div>
                    </div>
                    <span class="link-arrow">â†’</span>
                </a>
                <a href="https://www.youtube.com/@osouji-diary" target="_blank" rel="noopener noreferrer" class="link-item">
                    <span class="link-icon">ğŸ¥</span>
                    <div class="link-info">
                        <div class="link-title">ãŠãã†ã˜ãƒ€ã‚¤ã‚¢ãƒªãƒ¼</div>
                        <div class="link-desc">ä¸»å©¦ã«å¤§äººæ°—ï¼10åˆ†ã§åˆ†ã‹ã‚‹ãŠæƒé™¤ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</div>
                    </div>
                    <span class="link-arrow">â†’</span>
                </a>
                <a href="https://www.youtube.com/@yamachan-osouji" target="_blank" rel="noopener noreferrer" class="link-item">
                    <span class="link-icon">ğŸ¥</span>
                    <div class="link-info">
                        <div class="link-title">ãŠæƒé™¤TVã€æ£®ã®ã‚„ã¾ã¡ã‚ƒã‚“ã€‘</div>
                        <div class="link-desc">ç¾å½¹ãƒã‚¦ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°æ¥­è€…ãŒæ•™ãˆã‚‹ãŠæƒé™¤æƒ…å ±</div>
                    </div>
                    <span class="link-arrow">â†’</span>
                </a>
                <a href="https://panasonic.jp/life/housework/990002.html" target="_blank" rel="noopener noreferrer" class="link-item">
                    <span class="link-icon">ğŸŒ</span>
                    <div class="link-info">
                        <div class="link-title">æƒé™¤ã§æœŸå¾…ã§ãã‚‹åŠ¹æœã¨ç¿’æ…£åŒ–ã®ã‚³ãƒ„</div>
                        <div class="link-desc">Panasonic UP LIFE - å¥åº·ãƒ»å¿ƒãƒ»æš®ã‚‰ã—ã‚’æ•´ãˆã‚‹æ–¹æ³•</div>
                    </div>
                    <span class="link-arrow">â†’</span>
                </a>
            </div>
            
            <!-- æƒé™¤ã®åŠ©è¨€ -->
            <div class="advice-section">
                <div class="advice-title">ğŸŒ¿ æƒé™¤ã‚’æ¥½ã—ã‚€ãŸã‚ã®å¿ƒå¾—</div>
                <div class="advice-text">
                    <p>ğŸ”¹ <strong>å®Œç’§ã‚’ç›®æŒ‡ã•ãªã„</strong> - ã€Œä»Šæ—¥ã¯æœºã®ä¸Šã ã‘ã€ã§OKã€‚å°ã•ãªé”æˆæ„Ÿã®ç©ã¿é‡ã­ãŒç¿’æ…£åŒ–ã®éµã§ã™ã€‚</p>
                    <p>ğŸ”¹ <strong>ã€Œã¤ã„ã§æƒé™¤ã€ã‚’ç¿’æ…£ã«</strong> - æ‰‹ã‚’æ´—ã£ãŸã‚‰æ´—é¢å°ã‚’æ‹­ãã€ãŠé¢¨å‘‚ä¸ŠãŒã‚Šã«é¡ã‚’æ‹­ããªã©ã€æ—¥å¸¸ã®å‹•ä½œã«çµ„ã¿è¾¼ã¿ã¾ã—ã‚‡ã†ã€‚</p>
                    <p>ğŸ”¹ <strong>æƒé™¤ã¯é‹å‹•ã«ã‚‚ãªã‚‹</strong> - 20åˆ†ã®æƒé™¤ã§ç´„80kcalæ¶ˆè²»ï¼ä½“ã‚’å‹•ã‹ã—ãªãŒã‚‰éƒ¨å±‹ã‚‚ã‚­ãƒ¬ã‚¤ã«ä¸€çŸ³äºŒé³¥ã§ã™ã€‚</p>
                    <p>ğŸ”¹ <strong>ãƒ“ãƒ•ã‚©ãƒ¼ã‚¢ãƒ•ã‚¿ãƒ¼ã‚’æ¥½ã—ã‚€</strong> - å†™çœŸã‚’æ’®ã£ã¦å¤‰åŒ–ã‚’è¦‹ãˆã‚‹åŒ–ã™ã‚‹ã¨ã€é”æˆæ„ŸãŒå€å¢—ã—ã¾ã™ã€‚</p>
                    <p>ğŸ”¹ <strong>å¥½ããªéŸ³æ¥½ã¨ä¸€ç·’ã«</strong> - ãŠæ°—ã«å…¥ã‚Šã®æ›²1æ›²åˆ†ã ã‘æƒé™¤ã™ã‚‹ã¨æ±ºã‚ã‚‹ã¨ã€æ¥½ã—ãå–ã‚Šçµ„ã‚ã¾ã™ã€‚</p>
                    <p style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); font-style: italic; color: var(--accent);">
                        ã€Œæƒé™¤ã¯å˜ãªã‚‹å®¶äº‹ã§ã¯ãªãã€è‡ªåˆ†ã®å¿ƒã¨ç©ºé–“ã‚’æ•´ãˆã‚‹ã‚»ãƒ«ãƒ•ã‚±ã‚¢ã€‚<br>
                        ãã‚Œã„ãªéƒ¨å±‹ã¯ã€ãã‚Œã„ãªå¿ƒã‚’è‚²ã¦ã¾ã™âœ¨ã€
                    </p>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- ãŠç¥ã„ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="celebrateModal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="confetti">ğŸ‰âœ¨ğŸŠ</div>
            <h2>ğŸ† é€£ç¶šè¨˜éŒ²æ›´æ–°ï¼</h2>
            <div class="days" id="newBestStreak">---</div>
            <p>æ—¥é€£ç¶šé”æˆï¼ç´ æ™´ã‚‰ã—ã„ç¿’æ…£ã§ã™ï¼</p>
            <button class="btn-primary" onclick="closeModal()" style="margin-top: 20px;">OK</button>
        </div>
    </div>
    
    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="edit-modal" id="editModal" onclick="closeEditModal()">
        <div class="edit-modal-content" onclick="event.stopPropagation()">
            <h3>âœï¸ è¨˜éŒ²ã‚’ç·¨é›†</h3>
            <input type="hidden" id="editId">
            <div class="input-group full">
                <div>
                    <label>æ—¥ä»˜</label>
                    <input type="date" id="editDate">
                </div>
            </div>
            <div class="input-group full">
                <div>
                    <label>æƒé™¤ã—ãŸå ´æ‰€</label>
                    <div class="place-tags" id="editPlaceTags">
                        <span class="place-tag" data-place="ãƒªãƒ“ãƒ³ã‚°">ğŸ›‹ï¸ ãƒªãƒ“ãƒ³ã‚°</span>
                        <span class="place-tag" data-place="ã‚­ãƒƒãƒãƒ³">ğŸ³ ã‚­ãƒƒãƒãƒ³</span>
                        <span class="place-tag" data-place="æµ´å®¤">ğŸ› æµ´å®¤</span>
                        <span class="place-tag" data-place="ãƒˆã‚¤ãƒ¬">ğŸš½ ãƒˆã‚¤ãƒ¬</span>
                        <span class="place-tag" data-place="å¯å®¤">ğŸ›ï¸ å¯å®¤</span>
                        <span class="place-tag" data-place="ç„é–¢">ğŸšª ç„é–¢</span>
                        <span class="place-tag" data-place="ãƒ™ãƒ©ãƒ³ãƒ€">ğŸŒ¿ ãƒ™ãƒ©ãƒ³ãƒ€</span>
                        <span class="place-tag" data-place="ä»•äº‹å ´">ğŸ’¼ ä»•äº‹å ´</span>
                        <span class="place-tag" data-place="æ›¸é¡">ğŸ“„ æ›¸é¡</span>
                        <span class="place-tag" data-place="ãã®ä»–">âœ¨ ãã®ä»–</span>
                    </div>
                </div>
            </div>
            <div class="input-group full">
                <div>
                    <label>æº€è¶³åº¦</label>
                    <div class="star-rating">
                        <input type="radio" id="editStar5" name="editRating" value="5">
                        <input type="radio" id="editStar4" name="editRating" value="4">
                        <input type="radio" id="editStar3" name="editRating" value="3">
                        <input type="radio" id="editStar2" name="editRating" value="2">
                        <input type="radio" id="editStar1" name="editRating" value="1">
                        <label for="editStar5">â­</label>
                        <label for="editStar4">â­</label>
                        <label for="editStar3">â­</label>
                        <label for="editStar2">â­</label>
                        <label for="editStar1">â­</label>
                    </div>
                </div>
            </div>
            <div class="input-group full">
                <div>
                    <label>â±ï¸ æƒé™¤æ™‚é–“</label>
                    <select id="editTime">
                        <option value="15">15åˆ†</option>
                        <option value="30">30åˆ†</option>
                        <option value="45">45åˆ†</option>
                        <option value="60">1æ™‚é–“</option>
                        <option value="75">1æ™‚é–“15åˆ†</option>
                        <option value="90">1æ™‚é–“30åˆ†</option>
                        <option value="105">1æ™‚é–“45åˆ†</option>
                        <option value="120">2æ™‚é–“</option>
                        <option value="135">2æ™‚é–“15åˆ†</option>
                        <option value="150">2æ™‚é–“30åˆ†</option>
                        <option value="165">2æ™‚é–“45åˆ†</option>
                        <option value="180">3æ™‚é–“</option>
                    </select>
                </div>
            </div>
            <div class="input-group full">
                <div>
                    <label>ğŸ’­ ä»Šæ—¥ã®æ°—ã¥ããƒ»ãƒ¡ãƒ¢</label>
                    <textarea id="editNote" maxlength="500" oninput="updateEditCharCounter()"></textarea>
                    <div class="char-counter" id="editCharCounter">0 / 500</div>
                </div>
            </div>
            <div class="edit-modal-buttons">
                <button class="btn-cancel" onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn-primary" onclick="saveEdit()">ä¿å­˜ã™ã‚‹</button>
            </div>
        </div>
    </div>
    
    <!-- ã‚³ãƒ„ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="edit-modal" id="tipEditModal" onclick="closeTipEditModal()">
        <div class="edit-modal-content" onclick="event.stopPropagation()">
            <h3>âœï¸ ã‚³ãƒ„ã‚’ç·¨é›†</h3>
            <input type="hidden" id="editTipId">
            <div class="input-group full">
                <div>
                    <label>ã‚¢ã‚¤ã‚³ãƒ³</label>
                    <select id="editTipIcon">
                        <option value="â°">â° æ™‚è¨ˆ</option>
                        <option value="ğŸµ">ğŸµ éŸ³æ¥½</option>
                        <option value="ğŸ“¦">ğŸ“¦ ç®±</option>
                        <option value="âœ¨">âœ¨ ã‚­ãƒ©ã‚­ãƒ©</option>
                        <option value="ğŸ§¹">ğŸ§¹ ã»ã†ã</option>
                        <option value="ğŸŒŸ">ğŸŒŸ æ˜Ÿ</option>
                        <option value="ğŸ’ª">ğŸ’ª ç­‹è‚‰</option>
                        <option value="ğŸ¯">ğŸ¯ çš„</option>
                        <option value="â˜€ï¸">â˜€ï¸ å¤ªé™½</option>
                        <option value="ğŸŒ¸">ğŸŒ¸ èŠ±</option>
                    </select>
                </div>
            </div>
            <div class="input-group full">
                <div>
                    <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
                    <input type="text" id="editTipTitle" maxlength="30">
                </div>
            </div>
            <div class="input-group full">
                <div>
                    <label>èª¬æ˜</label>
                    <input type="text" id="editTipDesc" maxlength="50">
                </div>
            </div>
            <div class="edit-modal-buttons">
                <button class="btn-cancel" onclick="closeTipEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn-primary" onclick="saveTipEdit()">ä¿å­˜ã™ã‚‹</button>
            </div>
        </div>
    </div>
    
    <script>
        // ========================================
        // APIè¨­å®š - ä»¥ä¸‹ã®URLã‚’å®Ÿéš›ã®ãƒ‡ãƒ—ãƒ­ã‚¤URLã«ç½®ãæ›ãˆã¦ãã ã•ã„
        // ========================================
        const API_URL = ''; // â† ã“ã“ã«Google Apps Scriptã®ãƒ‡ãƒ—ãƒ­ã‚¤URLã‚’è¨­å®š
        
        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†
        let records = JSON.parse(localStorage.getItem('cleaningRecords')) || [];
        let goal = parseInt(localStorage.getItem('cleaningGoal')) || 5;
        let tips = JSON.parse(localStorage.getItem('cleaningTips')) || [
            { id: 1, icon: 'â°', title: 'æœã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã«çµ„ã¿è¾¼ã‚€', desc: 'èµ·åºŠå¾Œã®5åˆ†æƒé™¤ã§1æ—¥ã‚’æ°—æŒã¡ã‚ˆãã‚¹ã‚¿ãƒ¼ãƒˆ' },
            { id: 2, icon: 'ğŸµ', title: 'ãŠæ°—ã«å…¥ã‚Šã®éŸ³æ¥½ã‚’ã‹ã‘ã¦', desc: 'å¥½ããªæ›²1æ›²åˆ†ã ã‘æƒé™¤ã™ã‚‹ã¨æ±ºã‚ã‚‹ã¨æ¥½ã—ã„' },
            { id: 3, icon: 'ğŸ“¦', title: 'ã€Œ1æ—¥1æ¨ã¦ã€ã‚’ç¿’æ…£ã«', desc: 'æ¯æ—¥1ã¤ä¸è¦ãªã‚‚ã®ã‚’æ‰‹æ”¾ã™ã¨ã‚¹ãƒƒã‚­ãƒª' },
            { id: 4, icon: 'âœ¨', title: 'ã€Œã¤ã„ã§æƒé™¤ã€ã§åŠ¹ç‡ã‚¢ãƒƒãƒ—', desc: 'æ‰‹ã‚’æ´—ã£ãŸã‚‰æ´—é¢å°ã‚’æ‹­ãã€ãªã©ç¿’æ…£åŒ–' }
        ];
        let chart = null;
        let selectedPlaces = [];
        let editSelectedPlaces = [];
        
        // æ›œæ—¥
        const DAYS = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
        
        // åŒæœŸçŠ¶æ…‹è¡¨ç¤º
        function showSyncStatus(message, type) {
            const status = document.getElementById('syncStatus');
            status.textContent = message;
            status.className = 'sync-status ' + type;
            if (type !== 'loading') {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 5000);
            }
        }
        
        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¿å­˜ï¼ˆè‡ªå‹•ï¼‰
        async function syncToSpreadsheet() {
            if (!API_URL) return; // APIæœªè¨­å®šãªã‚‰ä½•ã‚‚ã—ãªã„
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({
                        action: 'save',
                        records: records,
                        goal: goal,
                        tips: tips
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSyncStatus('â˜ï¸ ã‚¯ãƒ©ã‚¦ãƒ‰ã«åŒæœŸã—ã¾ã—ãŸ', 'success');
                }
            } catch (error) {
                console.error('åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰èª­è¾¼ï¼ˆåˆæœŸåŒ–æ™‚ï¼‰
        async function loadFromSpreadsheet() {
            if (!API_URL) return false; // APIæœªè¨­å®šãªã‚‰ä½•ã‚‚ã—ãªã„
            
            showSyncStatus('ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...', 'loading');
            
            try {
                const response = await fetch(API_URL + '?action=load');
                const result = await response.json();
                
                if (result.success && result.records) {
                    records = result.records;
                    goal = result.goal || 5;
                    tips = result.tips || tips;
                    
                    // ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚‚ä¿å­˜
                    saveData();
                    saveTips();
                    localStorage.setItem('cleaningGoal', goal);
                    
                    showSyncStatus('â˜ï¸ ã‚¯ãƒ©ã‚¦ãƒ‰ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ', 'success');
                    return true;
                }
            } catch (error) {
                console.error('èª­è¾¼ã‚¨ãƒ©ãƒ¼:', error);
                showSyncStatus('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ä¸­', 'success');
            }
            return false;
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            document.getElementById('cleanDate').valueAsDate = new Date();
            document.getElementById('goalDays').value = goal;
            
            // å ´æ‰€ã‚¿ã‚°ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            document.querySelectorAll('#placeTags .place-tag').forEach(tag => {
                tag.addEventListener('click', () => togglePlace(tag));
            });
            document.querySelectorAll('#editPlaceTags .place-tag').forEach(tag => {
                tag.addEventListener('click', () => toggleEditPlace(tag));
            });
            
            // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•èª­ã¿è¾¼ã¿
            if (API_URL) {
                await loadFromSpreadsheet();
                document.getElementById('goalDays').value = goal;
            }
            
            updateDisplay();
            updateTipsList();
        });
        
        // å ´æ‰€ã®é¸æŠåˆ‡ã‚Šæ›¿ãˆ
        function togglePlace(tag) {
            const place = tag.dataset.place;
            if (selectedPlaces.includes(place)) {
                selectedPlaces = selectedPlaces.filter(p => p !== place);
                tag.classList.remove('selected');
            } else {
                selectedPlaces.push(place);
                tag.classList.add('selected');
            }
        }
        
        // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã§ã®å ´æ‰€é¸æŠ
        function toggleEditPlace(tag) {
            const place = tag.dataset.place;
            if (editSelectedPlaces.includes(place)) {
                editSelectedPlaces = editSelectedPlaces.filter(p => p !== place);
                tag.classList.remove('selected');
            } else {
                editSelectedPlaces.push(place);
                tag.classList.add('selected');
            }
        }
        
        // ã‚³ãƒ„è¿½åŠ 
        function addTip() {
            const icon = document.getElementById('tipIcon').value;
            const title = document.getElementById('tipTitle').value.trim();
            const desc = document.getElementById('tipDesc').value.trim();
            
            if (!title) {
                alert('ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            if (tips.length >= 5) {
                alert('ã‚³ãƒ„ã¯æœ€å¤§5ä»¶ã¾ã§ç™»éŒ²ã§ãã¾ã™');
                return;
            }
            
            tips.push({
                id: Date.now(),
                icon,
                title,
                desc: desc || ''
            });
            
            saveTips();
            syncToSpreadsheet(); // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è‡ªå‹•åŒæœŸ
            updateTipsList();
            
            // å…¥åŠ›æ¬„ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('tipTitle').value = '';
            document.getElementById('tipDesc').value = '';
        }
        
        // ã‚³ãƒ„å‰Šé™¤
        function deleteTip(id) {
            if (confirm('ã“ã®ã‚³ãƒ„ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                tips = tips.filter(t => t.id !== id);
                saveTips();
                syncToSpreadsheet(); // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è‡ªå‹•åŒæœŸ
                updateTipsList();
            }
        }
        
        // ã‚³ãƒ„ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openTipEditModal(id) {
            const tip = tips.find(t => t.id === id);
            if (!tip) return;
            
            document.getElementById('editTipId').value = id;
            document.getElementById('editTipIcon').value = tip.icon;
            document.getElementById('editTipTitle').value = tip.title;
            document.getElementById('editTipDesc').value = tip.desc;
            
            document.getElementById('tipEditModal').classList.add('show');
        }
        
        // ã‚³ãƒ„ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeTipEditModal() {
            document.getElementById('tipEditModal').classList.remove('show');
        }
        
        // ã‚³ãƒ„ç·¨é›†ã‚’ä¿å­˜
        function saveTipEdit() {
            const id = parseInt(document.getElementById('editTipId').value);
            const icon = document.getElementById('editTipIcon').value;
            const title = document.getElementById('editTipTitle').value.trim();
            const desc = document.getElementById('editTipDesc').value.trim();
            
            if (!title) {
                alert('ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const index = tips.findIndex(t => t.id === id);
            if (index === -1) return;
            
            tips[index] = { ...tips[index], icon, title, desc };
            
            saveTips();
            syncToSpreadsheet(); // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è‡ªå‹•åŒæœŸ
            updateTipsList();
            closeTipEditModal();
        }
        
        // ã‚³ãƒ„ãƒªã‚¹ãƒˆæ›´æ–°
        function updateTipsList() {
            const container = document.getElementById('tipsList');
            const addForm = document.getElementById('tipAddForm');
            
            // 5ä»¶ç™»éŒ²æ¸ˆã¿ã®å ´åˆã¯ãƒ•ã‚©ãƒ¼ãƒ ã‚’éè¡¨ç¤º
            if (tips.length >= 5) {
                addForm.style.display = 'none';
            } else {
                addForm.style.display = 'block';
            }
            
            if (tips.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ’¡</div>
                        <p>ã¾ã ã‚³ãƒ„ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“<br>è‡ªåˆ†ã ã‘ã®æƒé™¤ã®ã‚³ãƒ„ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ï¼</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = tips.map(t => `
                <div class="tip-item">
                    <span class="tip-icon">${t.icon}</span>
                    <div class="tip-content">
                        <div class="tip-title">${escapeHtml(t.title)}</div>
                        ${t.desc ? `<div class="tip-desc">${escapeHtml(t.desc)}</div>` : ''}
                    </div>
                    <div class="tip-actions">
                        <button class="edit-btn" onclick="openTipEditModal(${t.id})" title="ç·¨é›†">âœï¸</button>
                        <button class="delete-btn" onclick="deleteTip(${t.id})" title="å‰Šé™¤">Ã—</button>
                    </div>
                </div>
            `).join('');
        }
        
        // ã‚³ãƒ„ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        function saveTips() {
            localStorage.setItem('cleaningTips', JSON.stringify(tips));
        }
        
        // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
        function updateCharCounter() {
            const textarea = document.getElementById('cleanNote');
            const counter = document.getElementById('charCounter');
            const length = textarea.value.length;
            counter.textContent = `${length} / 500`;
            
            counter.classList.remove('warning', 'over');
            if (length >= 500) {
                counter.classList.add('over');
            } else if (length >= 400) {
                counter.classList.add('warning');
            }
        }
        
        function updateEditCharCounter() {
            const textarea = document.getElementById('editNote');
            const counter = document.getElementById('editCharCounter');
            const length = textarea.value.length;
            counter.textContent = `${length} / 500`;
            
            counter.classList.remove('warning', 'over');
            if (length >= 500) {
                counter.classList.add('over');
            } else if (length >= 400) {
                counter.classList.add('warning');
            }
        }
        
        // è¨˜éŒ²è¿½åŠ 
        function addRecord() {
            const date = document.getElementById('cleanDate').value;
            const rating = parseInt(document.querySelector('input[name="rating"]:checked')?.value) || 3;
            const time = parseInt(document.getElementById('cleanTime').value) || 30;
            const note = document.getElementById('cleanNote').value.trim();
            
            if (!date) {
                alert('æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            if (selectedPlaces.length === 0) {
                alert('æƒé™¤ã—ãŸå ´æ‰€ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const previousBestStreak = calculateBestStreak();
            
            records.push({
                id: Date.now(),
                date,
                places: [...selectedPlaces],
                rating,
                time,
                note
            });
            
            saveData();
            syncToSpreadsheet(); // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è‡ªå‹•åŒæœŸ
            updateDisplay();
            
            // é€£ç¶šè¨˜éŒ²æ›´æ–°ãƒã‚§ãƒƒã‚¯
            const newBestStreak = calculateBestStreak();
            if (newBestStreak > previousBestStreak && newBestStreak >= 7) {
                showCelebration(newBestStreak);
            }
            
            // å…¥åŠ›æ¬„ãƒªã‚»ãƒƒãƒˆ
            selectedPlaces = [];
            document.querySelectorAll('#placeTags .place-tag').forEach(tag => {
                tag.classList.remove('selected');
            });
            document.getElementById('cleanNote').value = '';
            document.getElementById('cleanTime').value = '30';
            document.querySelector('#star3').checked = true;
            updateCharCounter();
        }
        
        // è¡¨ç¤ºæ›´æ–°
        function updateDisplay() {
            updateStats();
            updateGoal();
            updateChart();
            updateHistory();
            updateWeekSummary();
        }
        
        // ä»Šé€±ã®ã‚µãƒãƒªãƒ¼æ›´æ–°
        function updateWeekSummary() {
            const container = document.getElementById('weekSummary');
            const messageEl = document.getElementById('weekMessage');
            
            const today = new Date();
            const dayOfWeek = today.getDay();
            
            // ä»Šé€±ã®æ—¥æ›œæ—¥ã‚’å–å¾—
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - dayOfWeek);
            weekStart.setHours(0, 0, 0, 0);
            
            let html = '';
            let weekCount = 0;
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(weekStart);
                date.setDate(weekStart.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                
                const hasRecord = records.some(r => r.date === dateStr);
                const isToday = i === dayOfWeek;
                
                if (hasRecord) weekCount++;
                
                html += `
                    <div class="day-circle ${hasRecord ? 'done' : ''} ${isToday ? 'today' : ''}">
                        ${DAYS[i]}
                    </div>
                `;
            }
            
            container.innerHTML = html;
            
            if (weekCount === 0) {
                messageEl.textContent = 'ä»Šé€±ã¯ã¾ã æƒé™¤è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å§‹ã‚ã¦ã¿ã¾ã—ã‚‡ã†ï¼';
            } else if (weekCount >= goal) {
                messageEl.textContent = `ğŸ‰ ä»Šé€±ã®ç›®æ¨™é”æˆï¼${weekCount}æ—¥æƒé™¤ã—ã¾ã—ãŸï¼`;
            } else {
                messageEl.textContent = `ä»Šé€±ã¯${weekCount}æ—¥æƒé™¤ã—ã¾ã—ãŸã€‚ç›®æ¨™ã¾ã§ã‚ã¨${goal - weekCount}æ—¥ï¼`;
            }
        }
        
        // é€£ç¶šæ—¥æ•°è¨ˆç®—
        function calculateCurrentStreak() {
            if (records.length === 0) return 0;
            
            const sortedDates = [...new Set(records.map(r => r.date))].sort().reverse();
            const today = new Date().toISOString().split('T')[0];
            const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
            
            // ä»Šæ—¥ã¾ãŸã¯æ˜¨æ—¥ã«è¨˜éŒ²ãŒãªã‘ã‚Œã°ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã¯0
            if (sortedDates[0] !== today && sortedDates[0] !== yesterday) {
                return 0;
            }
            
            let streak = 1;
            let currentDate = new Date(sortedDates[0]);
            
            for (let i = 1; i < sortedDates.length; i++) {
                const prevDate = new Date(currentDate);
                prevDate.setDate(prevDate.getDate() - 1);
                
                if (sortedDates[i] === prevDate.toISOString().split('T')[0]) {
                    streak++;
                    currentDate = prevDate;
                } else {
                    break;
                }
            }
            
            return streak;
        }
        
        // æœ€é«˜é€£ç¶šæ—¥æ•°è¨ˆç®—
        function calculateBestStreak() {
            if (records.length === 0) return 0;
            
            const sortedDates = [...new Set(records.map(r => r.date))].sort();
            let bestStreak = 1;
            let currentStreak = 1;
            
            for (let i = 1; i < sortedDates.length; i++) {
                const prevDate = new Date(sortedDates[i - 1]);
                const currDate = new Date(sortedDates[i]);
                const diffDays = (currDate - prevDate) / (1000 * 60 * 60 * 24);
                
                if (diffDays === 1) {
                    currentStreak++;
                    bestStreak = Math.max(bestStreak, currentStreak);
                } else {
                    currentStreak = 1;
                }
            }
            
            return bestStreak;
        }
        
        // çµ±è¨ˆæ›´æ–°
        function updateStats() {
            const currentStreak = calculateCurrentStreak();
            const bestStreak = calculateBestStreak();
            
            // ä»Šæœˆã®è¨˜éŒ²æ•°ã¨æ™‚é–“
            const now = new Date();
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];
            const monthlyRecords = records.filter(r => r.date >= monthStart);
            const monthlyCount = monthlyRecords.length;
            const monthlyTime = monthlyRecords.reduce((sum, r) => sum + (r.time || 0), 0);
            
            // ç·æ™‚é–“
            const totalTime = records.reduce((sum, r) => sum + (r.time || 0), 0);
            
            document.getElementById('currentStreak').textContent = currentStreak;
            document.getElementById('bestStreak').textContent = bestStreak;
            document.getElementById('monthlyCount').textContent = monthlyCount;
            document.getElementById('monthlyTime').textContent = formatTimeShort(monthlyTime);
            document.getElementById('totalCount').textContent = records.length;
            document.getElementById('totalTime').textContent = formatTimeShort(totalTime);
            
            // ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒãƒƒã‚¸
            const container = document.getElementById('streakContainer');
            if (currentStreak >= 7) {
                container.innerHTML = `<div class="streak-badge">ğŸ”¥ ${currentStreak}æ—¥é€£ç¶šãŠæƒé™¤ä¸­ï¼</div>`;
            } else if (currentStreak >= 3) {
                container.innerHTML = `<div class="streak-badge">âœ¨ ${currentStreak}æ—¥é€£ç¶šé”æˆä¸­ï¼</div>`;
            } else {
                container.innerHTML = '';
            }
        }
        
        // æ™‚é–“ã‚’çŸ­ã„å½¢å¼ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatTimeShort(minutes) {
            if (minutes === 0) return '0åˆ†';
            if (minutes < 60) {
                return `${minutes}åˆ†`;
            } else {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                if (mins === 0) {
                    return `${hours}h`;
                } else {
                    return `${hours}h${mins}m`;
                }
            }
        }
        
        // ç›®æ¨™å¤‰æ›´ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ï¼‰
        function changeGoal() {
            updateGoal();
            syncToSpreadsheet(); // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è‡ªå‹•åŒæœŸ
        }
        
        // ç›®æ¨™æ›´æ–°
        function updateGoal() {
            goal = parseInt(document.getElementById('goalDays').value) || 5;
            localStorage.setItem('cleaningGoal', goal);
            
            // ä»Šé€±ã®æƒé™¤æ—¥æ•°ã‚’è¨ˆç®—
            const today = new Date();
            const dayOfWeek = today.getDay();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - dayOfWeek);
            const weekStartStr = weekStart.toISOString().split('T')[0];
            
            const weekDays = [...new Set(records.filter(r => r.date >= weekStartStr).map(r => r.date))].length;
            const progress = Math.min(100, Math.round((weekDays / goal) * 100));
            
            document.getElementById('goalBar').style.width = progress + '%';
            document.getElementById('goalText').textContent = progress + '%';
            
            const diff = goal - weekDays;
            if (diff <= 0) {
                document.getElementById('goalMessage').textContent = 'ğŸ‰ ä»Šé€±ã®ç›®æ¨™é”æˆï¼ã“ã®èª¿å­ã§ç¶šã‘ã¾ã—ã‚‡ã†ï¼';
            } else {
                document.getElementById('goalMessage').textContent = `ç›®æ¨™ã¾ã§ã‚ã¨ ${diff} æ—¥ï¼é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼`;
            }
        }
        
        // ã‚°ãƒ©ãƒ•æ›´æ–°
        function updateChart() {
            const ctx = document.getElementById('cleanChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            if (records.length === 0) {
                return;
            }
            
            // ä»Šé€±ã®æ—¥æ›œæ—¥ã‚’å–å¾—
            const now = new Date();
            const dayOfWeek = now.getDay(); // 0=æ—¥æ›œæ—¥
            const thisWeekSunday = new Date(now);
            thisWeekSunday.setDate(now.getDate() - dayOfWeek);
            thisWeekSunday.setHours(0, 0, 0, 0);
            
            // æœ€ã‚‚å¤ã„è¨˜éŒ²ã®é€±ã‚’å–å¾—
            const oldestRecord = records.reduce((oldest, r) => 
                r.date < oldest ? r.date : oldest, records[0].date);
            const oldestDate = new Date(oldestRecord);
            const oldestDayOfWeek = oldestDate.getDay();
            const oldestWeekSunday = new Date(oldestDate);
            oldestWeekSunday.setDate(oldestDate.getDate() - oldestDayOfWeek);
            oldestWeekSunday.setHours(0, 0, 0, 0);
            
            // æœ€ã‚‚å¤ã„è¨˜éŒ²ã®é€±ã‹ã‚‰ä»Šé€±ã¾ã§ã®é€±æ•°ã‚’è¨ˆç®—ï¼ˆæœ€å¤§8é€±é–“ï¼‰
            const weeksDiff = Math.floor((thisWeekSunday - oldestWeekSunday) / (7 * 24 * 60 * 60 * 1000));
            const numWeeks = Math.min(weeksDiff + 1, 8);
            
            const weeks = [];
            const counts = [];
            
            for (let i = numWeeks - 1; i >= 0; i--) {
                // å„é€±ã®æ—¥æ›œæ—¥ï¼ˆé€±ã®é–‹å§‹ï¼‰
                const weekStart = new Date(thisWeekSunday);
                weekStart.setDate(thisWeekSunday.getDate() - (i * 7));
                
                // å„é€±ã®åœŸæ›œæ—¥ï¼ˆé€±ã®çµ‚ã‚ã‚Šï¼‰
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                
                const weekStartStr = weekStart.toISOString().split('T')[0];
                const weekEndStr = weekEnd.toISOString().split('T')[0];
                
                const count = [...new Set(records
                    .filter(r => r.date >= weekStartStr && r.date <= weekEndStr)
                    .map(r => r.date))].length;
                
                weeks.push(`${weekStart.getMonth() + 1}/${weekStart.getDate()}ã€œ`);
                counts.push(count);
            }
            
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: weeks,
                    datasets: [{
                        label: 'æƒé™¤ã—ãŸæ—¥æ•°',
                        data: counts,
                        backgroundColor: 'rgba(46, 204, 113, 0.6)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: { color: '#2e7d32' }
                        },
                        annotation: {
                            annotations: {
                                goalLine: {
                                    type: 'line',
                                    yMin: goal,
                                    yMax: goal,
                                    borderColor: 'rgba(245, 176, 65, 0.7)',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        display: true,
                                        content: 'ç›®æ¨™',
                                        position: 'end',
                                        backgroundColor: 'rgba(245, 176, 65, 0.8)',
                                        color: '#fff',
                                        font: { size: 11 }
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 7,
                            grid: { color: 'rgba(0,100,0,0.1)' },
                            ticks: { 
                                color: '#66bb6a',
                                stepSize: 1
                            }
                        },
                        x: {
                            grid: { color: 'rgba(0,100,0,0.05)' },
                            ticks: { color: '#66bb6a' }
                        }
                    }
                }
            });
        }
        
        // æ™‚é–“ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatTime(minutes) {
            if (minutes < 60) {
                return `${minutes}åˆ†`;
            } else {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                if (mins === 0) {
                    return `${hours}æ™‚é–“`;
                } else {
                    return `${hours}æ™‚é–“${mins}åˆ†`;
                }
            }
        }
        
        // å±¥æ­´æ›´æ–°
        function updateHistory() {
            const container = document.getElementById('historyList');
            
            if (records.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ§¹</div>
                        <p>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“<br>æœ€åˆã®æƒé™¤ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼</p>
                    </div>
                `;
                return;
            }
            
            const sorted = [...records].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = sorted.map(r => {
                const d = new Date(r.date);
                const dateStr = `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()}ï¼ˆ${DAYS[d.getDay()]}ï¼‰`;
                const stars = 'â­'.repeat(r.rating);
                const timeStr = r.time ? formatTime(r.time) : '';
                
                const noteSection = r.note ? `
                    <div class="history-note">
                        <div class="history-note-label">ğŸ’­ ãƒ¡ãƒ¢</div>
                        <div class="history-note-text">${escapeHtml(r.note)}</div>
                    </div>
                ` : '';
                
                return `
                    <div class="history-item">
                        <div class="history-header">
                            <div>
                                <div class="history-date">${dateStr}</div>
                                <div class="history-place">ğŸ“ ${r.places.join('ã€')}</div>
                                ${timeStr ? `<div class="history-time">â±ï¸ ${timeStr}</div>` : ''}
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="history-stars">${stars}</span>
                                <div class="action-buttons">
                                    <button class="edit-btn" onclick="openEditModal(${r.id})" title="ç·¨é›†">âœï¸</button>
                                    <button class="delete-btn" onclick="deleteRecord(${r.id})" title="å‰Šé™¤">Ã—</button>
                                </div>
                            </div>
                        </div>
                        ${noteSection}
                    </div>
                `;
            }).join('');
        }
        
        // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // è¨˜éŒ²å‰Šé™¤
        function deleteRecord(id) {
            if (confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                records = records.filter(r => r.id !== id);
                saveData();
                syncToSpreadsheet(); // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è‡ªå‹•åŒæœŸ
                updateDisplay();
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        function saveData() {
            localStorage.setItem('cleaningRecords', JSON.stringify(records));
        }
        
        // ãŠç¥ã„è¡¨ç¤º
        function showCelebration(days) {
            document.getElementById('newBestStreak').textContent = days;
            document.getElementById('celebrateModal').classList.add('show');
        }
        
        function closeModal() {
            document.getElementById('celebrateModal').classList.remove('show');
        }
        
        // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openEditModal(id) {
            const record = records.find(r => r.id === id);
            if (!record) return;
            
            document.getElementById('editId').value = id;
            document.getElementById('editDate').value = record.date;
            document.getElementById('editNote').value = record.note || '';
            document.getElementById('editTime').value = record.time || 30;
            
            // å ´æ‰€ã®é¸æŠçŠ¶æ…‹ã‚’å¾©å…ƒ
            editSelectedPlaces = [...record.places];
            document.querySelectorAll('#editPlaceTags .place-tag').forEach(tag => {
                if (editSelectedPlaces.includes(tag.dataset.place)) {
                    tag.classList.add('selected');
                } else {
                    tag.classList.remove('selected');
                }
            });
            
            // è©•ä¾¡ã®é¸æŠçŠ¶æ…‹ã‚’å¾©å…ƒ
            const ratingInput = document.querySelector(`input[name="editRating"][value="${record.rating}"]`);
            if (ratingInput) ratingInput.checked = true;
            
            updateEditCharCounter();
            document.getElementById('editModal').classList.add('show');
        }
        
        // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            editSelectedPlaces = [];
        }
        
        // ç·¨é›†å†…å®¹ã‚’ä¿å­˜
        function saveEdit() {
            const id = parseInt(document.getElementById('editId').value);
            const date = document.getElementById('editDate').value;
            const rating = parseInt(document.querySelector('input[name="editRating"]:checked')?.value) || 3;
            const time = parseInt(document.getElementById('editTime').value) || 30;
            const note = document.getElementById('editNote').value.trim();
            
            if (!date) {
                alert('æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            if (editSelectedPlaces.length === 0) {
                alert('æƒé™¤ã—ãŸå ´æ‰€ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const index = records.findIndex(r => r.id === id);
            if (index === -1) return;
            
            records[index] = {
                ...records[index],
                date,
                places: [...editSelectedPlaces],
                rating,
                time,
                note
            };
            
            saveData();
            syncToSpreadsheet(); // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è‡ªå‹•åŒæœŸ
            updateDisplay();
            closeEditModal();
        }
        
        // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportData() {
            const data = {
                records,
                goal,
                tips,
                exportDate: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cleaning_records_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.records && Array.isArray(data.records)) {
                        if (confirm(`${data.records.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚\næ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) {
                            records = data.records;
                            if (data.goal) {
                                goal = data.goal;
                                document.getElementById('goalDays').value = goal;
                            }
                            if (data.tips && Array.isArray(data.tips)) {
                                tips = data.tips;
                                saveTips();
                                updateTipsList();
                            }
                            saveData();
                            updateDisplay();
                            alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                        }
                    } else {
                        alert('ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ã™');
                    }
                } catch (err) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }
    </script>
</body>
</html>
